!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var n;n="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,n.steemWS=e()}}(function(){var e;return function n(e,t,o){function i(r,s){if(!t[r]){if(!e[r]){var u="function"==typeof require&&require;if(!s&&u)return u(r,!0);if(c)return c(r,!0);var a=new Error("Cannot find module '"+r+"'");throw a.code="MODULE_NOT_FOUND",a}var l=t[r]={exports:{}};e[r][0].call(l.exports,function(n){var t=e[r][1][n];return i(t?t:n)},l,l.exports,n,e,t,o)}return t[r].exports}for(var c="function"==typeof require&&require,r=0;r<o.length;r++)i(o[r]);return i}({1:[function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i,c=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),r=e("./WebSocketRpc"),s=e("./SteemApi"),u={url:"wss://this.piston.rocks",user:"",pass:"",debug:!1,apis:["database_api","network_broadcast_api"]};n.exports={setRpcConnectionStatusCallback:function(e){this.statusCb=e,i&&i.setRpcConnectionStatusCallback(e)},reset:function(e){return i&&this.close(),i=new a(e),i.connect(),i},get:function(e,n){return i||(i=new a(e)),n&&(i.setOptions(e),i.connect()),i},close:function(){i.close(),i=null}};var a=function(){function e(n){o(this,e),this.setOptions(n)}return c(e,[{key:"setOptions",value:function(e){this.options=Object.assign({},u,e),-1===this.options.apis.indexOf("database_api")&&this.options.apis.unshift("database_api")}},{key:"connect",value:function(){var e=this;if(!this.wsRpc){try{this.wsRpc=new r(this.options.url)}catch(n){console.err("wsRpc open error:",n)}this.initPromise=this.wsRpc.login(this.options.user,this.options.pass).then(function(){var n=[];return e.options.apis.forEach(function(t){e["_"+t]=new s(e.wsRpc,t),e[t]=function(){return this["_"+t]},n.push(e["_"+t].init().then(function(){return"database_api"===t?e[t]().exec("get_config",[]).then(function(n){return e.chainId=n.STEEMIT_CHAIN_ID,"connected to "+t}):"connected to "+t}))}),Promise.all(n)})["catch"](function(n){throw new Error("Unable to connect to "+e.options.url)})}}},{key:"close",value:function(){this.wsRpc&&(this.wsRpc.close(),this.wsRpc=null),this.options=null}}]),e}()},{"./SteemApi":2,"./WebSocketRpc":3}],2:[function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),c=function(){function e(n,t){o(this,e),this.wsRpc=n,this.apiName=t}return i(e,[{key:"init",value:function(){var e=this;return this.wsRpc.getApiByName(this.apiName).then(function(n){return e.apiId=n,e})}},{key:"exec",value:function(e,n){return this.wsRpc.call([this.apiId,e,n])["catch"](function(t){throw console.error("SteemApi error:",e,n,JSON.stringify(t)),new Error("SteemApi error:"+e+n+JSON.stringify(t))})}}]),e}();n.exports=c},{}],3:[function(e,n,t){"use strict";function o(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,n){for(var t=0;t<n.length;t++){var o=n[t];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(n,t,o){return t&&e(n.prototype,t),o&&e(n,o),n}}(),c=function(){function n(t){var i=this;o(this,n);var c="undefined"!=typeof WebSocket?e("ReconnectingWebSocket"):e("websocket").w3cwebsocket;try{this.ws=new c(t)}catch(r){console.error("ws error:",r)}this.ws.timeoutInterval=15e3,this.connectPromise=new Promise(function(e,n){i.ws.onopen=function(){e()},i.ws.onerror=function(e){n(e)},i.ws.onmessage=function(e){i.listener(JSON.parse(e.data))}}),this.cbId=0,this.cbs=new Map}return i(n,[{key:"listener",value:function(e){var n=this.cbs.get(e.id);n&&("error"in e?n.reject(e.error):n.resolve(e.result))}},{key:"call",value:function(e){var n=this,t={method:"call",params:e,id:this.cbId++};return new Promise(function(e,o){n.cbs.set(t.id,{time:new Date,resolve:e,reject:o}),n.ws.onerror=function(e){o(e)},n.ws.send(JSON.stringify(t))})}},{key:"getApiByName",value:function(e){return this.call([1,"get_api_by_name",[e]])}},{key:"login",value:function(e,n){var t=this;return this.connectPromise.then(function(){return t.call([1,"login",[e,n]])})}},{key:"close",value:function(){this.ws.close()}}]),n}();n.exports=c},{ReconnectingWebSocket:5,websocket:6}],4:[function(e,n,t){"use strict";var o=e("./ApiInstance");n.exports={Client:o}},{"./ApiInstance":1}],5:[function(n,t,o){!function(n,o){"function"==typeof e&&e.amd?e([],o):"undefined"!=typeof t&&t.exports?t.exports=o():n.ReconnectingWebSocket=o()}(this,function(){function e(n,t,o){function i(e,n){var t=document.createEvent("CustomEvent");return t.initCustomEvent(e,!1,!1,n),t}var c={debug:!1,automaticOpen:!0,reconnectInterval:1e3,maxReconnectInterval:3e4,reconnectDecay:1.5,timeoutInterval:2e3,maxReconnectAttempts:null,binaryType:"blob"};o||(o={});for(var r in c)"undefined"!=typeof o[r]?this[r]=o[r]:this[r]=c[r];this.url=n,this.reconnectAttempts=0,this.readyState=WebSocket.CONNECTING,this.protocol=null;var s,u=this,a=!1,l=!1,f=document.createElement("div");f.addEventListener("open",function(e){u.onopen(e)}),f.addEventListener("close",function(e){u.onclose(e)}),f.addEventListener("connecting",function(e){u.onconnecting(e)}),f.addEventListener("message",function(e){u.onmessage(e)}),f.addEventListener("error",function(e){u.onerror(e)}),this.addEventListener=f.addEventListener.bind(f),this.removeEventListener=f.removeEventListener.bind(f),this.dispatchEvent=f.dispatchEvent.bind(f),this.open=function(n){if(s=new WebSocket(u.url,t||[]),s.binaryType=this.binaryType,n){if(this.maxReconnectAttempts&&this.reconnectAttempts>this.maxReconnectAttempts)return}else f.dispatchEvent(i("connecting")),this.reconnectAttempts=0;(u.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","attempt-connect",u.url);var o=s,c=setTimeout(function(){(u.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","connection-timeout",u.url),l=!0,o.close(),l=!1},u.timeoutInterval);s.onopen=function(t){clearTimeout(c),(u.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onopen",u.url),u.protocol=s.protocol,u.readyState=WebSocket.OPEN,u.reconnectAttempts=0;var o=i("open");o.isReconnect=n,n=!1,f.dispatchEvent(o)},s.onclose=function(t){if(clearTimeout(c),s=null,a)u.readyState=WebSocket.CLOSED,f.dispatchEvent(i("close"));else{u.readyState=WebSocket.CONNECTING;var o=i("connecting");o.code=t.code,o.reason=t.reason,o.wasClean=t.wasClean,f.dispatchEvent(o),n||l||((u.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onclose",u.url),f.dispatchEvent(i("close")));var c=u.reconnectInterval*Math.pow(u.reconnectDecay,u.reconnectAttempts);setTimeout(function(){u.reconnectAttempts++,u.open(!0)},c>u.maxReconnectInterval?u.maxReconnectInterval:c)}},s.onmessage=function(n){(u.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onmessage",u.url,n.data);var t=i("message");t.data=n.data,f.dispatchEvent(t)},s.onerror=function(n){(u.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","onerror",u.url,n),f.dispatchEvent(i("error"))}},1==this.automaticOpen&&this.open(!1),this.send=function(n){if(s)return(u.debug||e.debugAll)&&console.debug("ReconnectingWebSocket","send",u.url,n),s.send(n);throw"INVALID_STATE_ERR : Pausing to reconnect websocket"},this.close=function(e,n){"undefined"==typeof e&&(e=1e3),a=!0,s&&s.close(e,n)},this.refresh=function(){s&&s.close()}}if("WebSocket"in window)return e.prototype.onopen=function(e){},e.prototype.onclose=function(e){},e.prototype.onconnecting=function(e){},e.prototype.onmessage=function(e){},e.prototype.onerror=function(e){},e.debugAll=!1,e.CONNECTING=WebSocket.CONNECTING,e.OPEN=WebSocket.OPEN,e.CLOSING=WebSocket.CLOSING,e.CLOSED=WebSocket.CLOSED,e})},{}],6:[function(e,n,t){},{}]},{},[4])(4)});